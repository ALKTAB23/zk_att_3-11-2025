════════════════════════════════════════════════════════════
دليل تفصيلي لإعداد قواعد Attendance Policy
════════════════════════════════════════════════════════════

الدوام المفترض: 09:00 - 16:30
فترة السماح: 15 دقيقة دخول، 30 دقيقة خروج

════════════════════════════════════════════════════════════
1️⃣ OVERTIME RULES (قواعد الإضافي)
════════════════════════════════════════════════════════════
الهدف: حساب ساعات العمل الإضافية بعد 16:30

الإعداد:
┌─────────────────────────────────────────────────────────┐
│ Name: TEST 1212                                         │
│ Type: Working Day  ← مهم جداً! (workday)               │
│ Apply After: 00:00 ← بدء حساب الإضافي مباشرة           │
│ Rate: 2.00         ← ضرب ساعات الإضافي × 2             │
└─────────────────────────────────────────────────────────┘

مثال:
- خروج فعلي: 18:30
- خروج متوقع: 16:30
- إضافي خام: 2 ساعة
- Permit Check Out: 30 دقيقة (0.5 ساعة)
- إضافي بعد السماح: 2 - 0.5 = 1.5 ساعة
- Apply After: 0.0 (أقل من 1.5 ✓)
- الإضافي النهائي: 1.5 × 2.00 = 3.0 ساعات

ملاحظات:
⚠️ Type يجب أن يكون "Working Day" لأيام العمل العادية
⚠️ Apply After = 0.00 يعني حساب الإضافي من أول دقيقة بعد السماح
⚠️ إذا وضعت Apply After = 1.00، سيحسب الإضافي فقط بعد ساعة كاملة

════════════════════════════════════════════════════════════
2️⃣ DIFFERENCE TIME RULE (قواعد الخروج المبكر)
════════════════════════════════════════════════════════════
الهدف: حساب ساعات الخروج قبل 16:30

اضغط على "DIFFERENCE TIME RULE" ثم "TEST 1" لتعديل القواعد:

الإعداد المقترح (قاعدة واحدة بسيطة):
┌─────────────────────────────────────────────────────────┐
│ Name: TEST 1                                            │
│ Counter: First Time  ← أول مرة خروج مبكر               │
│ From Time: 0.00      ← من كم ساعة                      │
│ To Time: 24.00       ← إلى كم ساعة                     │
│ Type: rate           ← ضرب في معامل                    │
│ Rate: 1.0            ← احسب كامل الخروج المبكر          │
│ Hours: 0.0           ← (غير مستخدم في type=rate)       │
└─────────────────────────────────────────────────────────┘

مثال:
- خروج فعلي: 16:00
- خروج متوقع: 16:30
- فرق خام: 0.5 ساعة (30 دقيقة)
- Permit Check Out: 30 دقيقة (0.5 ساعة)
- فرق بعد السماح: 0.5 - 0.5 = 0.0 ساعة
- القاعدة: Counter=1, 0.0 >= 0.00 AND 0.0 <= 24.00 ✓
- diff_time = 0.0 × 1.0 = 0.0 ساعة (لا يحسب خروج مبكر)

مثال آخر:
- خروج فعلي: 15:00
- خروج متوقع: 16:30
- فرق خام: 1.5 ساعة
- Permit: 0.5 ساعة
- فرق بعد السماح: 1.5 - 0.5 = 1.0 ساعة
- diff_time = 1.0 × 1.0 = 1.0 ساعة ← يحسب خروج مبكر

إعداد متقدم (حسب عدد المرات):
┌──────────┬──────────┬─────────┬──────┬──────┬────────┐
│ Counter  │ From     │ To      │ Type │ Rate │ Hours  │
├──────────┼──────────┼─────────┼──────┼──────┼────────┤
│ 1st Time │ 0.00     │ 1.00    │ rate │ 0.5  │ 0.0    │
│ 2nd Time │ 0.00     │ 1.00    │ rate │ 0.75 │ 0.0    │
│ 3rd Time │ 0.00     │ 24.00   │ rate │ 1.0  │ 0.0    │
└──────────┴──────────┴─────────┴──────┴──────┴────────┘
المعنى:
- أول مرة خروج مبكر <= 1 ساعة: احسب 50٪
- ثاني مرة: احسب 75٪
- ثالث مرة فأكثر: احسب 100٪

════════════════════════════════════════════════════════════
3️⃣ LATE IN RULE (قواعد التأخير)
════════════════════════════════════════════════════════════
الهدف: حساب ساعات التأخير عن 09:00 (بعد السماح)

اضغط على "LATE IN RULE" ثم "TEST 1" لتعديل القواعد:

الإعداد المقترح (قاعدة واحدة بسيطة):
┌─────────────────────────────────────────────────────────┐
│ Name: TEST 1                                            │
│ Counter: First Time  ← أول تأخير                       │
│ From Time: 0.00      ← من كم ساعة                      │
│ To Time: 24.00       ← إلى كم ساعة                     │
│ Type: rate           ← ضرب في معامل                    │
│ Rate: 1.0            ← احسب كامل التأخير                │
│ Hours: 0.0           ← (غير مستخدم)                    │
└─────────────────────────────────────────────────────────┘

مثال:
- دخول فعلي: 09:20
- دخول متوقع: 09:00
- تأخير خام: 0.333 ساعة (20 دقيقة)
- Permit Check In: 15 دقيقة (0.25 ساعة)
- تأخير بعد السماح: 0.333 - 0.25 = 0.083 ساعة (5 دقائق)
- القاعدة: Counter=1, 0.083 >= 0.00 AND 0.083 <= 24.00 ✓
- late_in = 0.083 × 1.0 = 0.083 ساعة

إعداد متقدم (عقوبات تصاعدية):
┌──────────┬──────────┬─────────┬──────────┬──────┬────────┐
│ Counter  │ From     │ To      │ Type     │ Rate │ Hours  │
├──────────┼──────────┼─────────┼──────────┼──────┼────────┤
│ 1st Time │ 0.00     │ 0.50    │ rate     │ 1.0  │ 0.0    │ ← تأخير حتى 30 دقيقة
│ 1st Time │ 0.50     │ 24.00   │ rate_fix │ 2.0  │ 0.5    │ ← تأخير > 30 دقيقة
│ 2nd Time │ 0.00     │ 24.00   │ fix      │ 0.0  │ 1.0    │ ← ثاني تأخير: خصم ساعة
│ 3rd Time │ 0.00     │ 24.00   │ fix      │ 0.0  │ 2.0    │ ← ثالث تأخير: خصم ساعتين
└──────────┴──────────┴─────────┴──────────┴──────┴────────┘

شرح الأنواع (Type):
- rate: late_in = act_late_in × Rate
- fix: late_in = Hours (قيمة ثابتة)
- rate_fix: late_in = (act_late_in × Rate) + Hours

════════════════════════════════════════════════════════════
4️⃣ ABSENCE RULE (قواعد الغياب)
════════════════════════════════════════════════════════════
الهدف: حساب ساعات/أيام الغياب

اضغط على "ABSENCE RULE" ثم "TEST 1" لتعديل القواعد:

الإعداد المقترح:
┌─────────────────────────────────────────────────────────┐
│ Name: TEST 1                                            │
│ Counter: First Time  ← أول يوم غياب                    │
│ Rate: 1.0            ← احسب يوم كامل                   │
└─────────────────────────────────────────────────────────┘

مثال:
- الموظف غائب يوم كامل
- ساعات العمل اليومية: 7.5 ساعة
- Counter: 1 (أول غياب)
- Rate: 1.0
- absence_hours = 7.5 × 1.0 = 7.5 ساعة

إعداد متقدم:
┌──────────┬──────┐
│ Counter  │ Rate │
├──────────┼──────┤
│ 1st Time │ 0.5  │ ← أول غياب: احسب 50٪
│ 2nd Time │ 0.75 │ ← ثاني غياب: احسب 75٪
│ 3rd Time │ 1.0  │ ← ثالث غياب: احسب 100٪
│ 4th Time │ 1.5  │ ← رابع غياب: احسب 150٪ (عقوبة)
└──────────┴──────┘

════════════════════════════════════════════════════════════
5️⃣ FORGET REGISTER RULE (قواعد نسيان البصمة)
════════════════════════════════════════════════════════════
الهدف: عقوبة عند نسيان Check In أو Check Out

اضغط على "FORGET REGISTER RULE" ثم "TEST 1" لتعديل القواعد:

الإعداد المقترح:
┌─────────────────────────────────────────────────────────┐
│ Name: TEST 1                                            │
│ Counter: First Time  ← أول مرة نسيان                   │
│ Rate: 0.5            ← خصم نصف يوم                     │
└─────────────────────────────────────────────────────────┘

مثال:
- الموظف نسي Check Out
- ساعات العمل اليومية: 7.5 ساعة
- Counter: 1
- Rate: 0.5
- forget_hours = 7.5 × 0.5 = 3.75 ساعة ← يخصم نصف يوم

إعداد متقدم:
┌──────────┬──────┐
│ Counter  │ Rate │
├──────────┼──────┤
│ 1st Time │ 0.25 │ ← أول مرة: خصم ربع يوم
│ 2nd Time │ 0.5  │ ← ثاني مرة: خصم نصف يوم
│ 3rd Time │ 1.0  │ ← ثالث مرة: خصم يوم كامل
└──────────┴──────┘

════════════════════════════════════════════════════════════
الإعداد الموصى به للبداية (بسيط):
════════════════════════════════════════════════════════════

1. Permit Check In: 15 دقيقة
2. Permit Check Out: 30 دقيقة

3. Overtime Rule:
   - Type: Working Day
   - Apply After: 00:00
   - Rate: 2.00

4. Diff Time Rule:
   - Counter: First Time
   - From: 0.00, To: 24.00
   - Type: rate, Rate: 1.0

5. Late In Rule:
   - Counter: First Time
   - From: 0.00, To: 24.00
   - Type: rate, Rate: 1.0

6. Absence Rule:
   - Counter: First Time
   - Rate: 1.0

7. Forget Rule:
   - Counter: First Time
   - Rate: 0.5

════════════════════════════════════════════════════════════
ملاحظات مهمة:
════════════════════════════════════════════════════════════

✓ Counter يتزايد تلقائياً: 1st, 2nd, 3rd...
✓ From/To بالساعات: 0.25 = 15 دقيقة، 0.5 = 30 دقيقة، 1.0 = 60 دقيقة
✓ Rate يضرب في القيمة الفعلية
✓ Hours يضاف (إذا Type = fix أو rate_fix)
✓ Permit يطرح قبل تطبيق القواعد

