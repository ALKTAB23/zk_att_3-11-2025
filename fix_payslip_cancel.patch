#!/bin/bash
# ุฅุตูุงุญ ุฎุทุฃ action_payslip_cancel ูู hr_payroll_custom.py
# ุชุดุบูู ูุฐุง ุงูููู ุนูู ุงูุณูุฑูุฑ ูู root

ODOO_PATH="/opt/odoo16/custom/hr_shifts_custom"
FILE="$ODOO_PATH/models/hr_payroll_custom.py"

echo "๐ง ุฅุตูุงุญ hr_payroll_custom.py..."
echo "======================================"

# 1. ุงูุชุญูู ูู ูุฌูุฏ ุงูููู
if [ ! -f "$FILE" ]; then
    echo "โ ุงูููู ุบูุฑ ููุฌูุฏ: $FILE"
    exit 1
fi

# 2. ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ
cp "$FILE" "$FILE.backup_$(date +%Y%m%d_%H%M%S)"
echo "โ ุชู ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ"

# 3. ุฅุตูุงุญ ุงูุฎุทุฃ
sed -i 's/if self\.payslip_id\.move_id:/if self.move_id:/g' "$FILE"
sed -i 's/self\.payslip_id\.move_id\.sudo()/self.move_id.sudo()/g' "$FILE"

echo "โ ุชู ุฅุตูุงุญ ุงูููุฏ"

# 4. ุนุฑุถ ุงูุชุบููุฑุงุช
echo ""
echo "๐ ุงูุชุบููุฑุงุช ุงููุทุจูุฉ:"
echo "======================================"
grep -n "if self.move_id:" "$FILE"

# 5. ุฅุนุงุฏุฉ ุชุดุบูู Odoo
echo ""
echo "๐ ุฅุนุงุฏุฉ ุชุดุบูู Odoo..."
systemctl restart odoo

echo ""
echo "โ ุชู ุงูุฅุตูุงุญ ุจูุฌุงุญ!"
echo "======================================"
echo "ุงูุฑุฌุงุก ุงูุงูุชุธุงุฑ 10-15 ุซุงููุฉ ูุฅุนุงุฏุฉ ุชุดุบูู Odoo"
